<!DOCTYPE html>
<!-- MOBILE-FIRST VERTICAL HARD-LOCK -->
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Scanner Simbi√≥tico ¬∑ Hub1 ‚Üí Dual</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      /* Nebula Pro + Base Madeira */
      --bg-body: radial-gradient(circle at top, #261640 0%, #050715 45%, #020309 100%);
      --card-bg: rgba(9, 11, 30, 0.96);
      --card-soft: rgba(15, 19, 45, 0.96);
      --card-border: rgba(150, 192, 255, 0.28);

      --accent-main: #ff6dd9;
      --accent-soft: #8ef0c0;
      --accent-warm: #ffcf65;

      --text-main: #f7f7ff;
      --text-soft: #c4c8f0;
      --text-muted: #8a8fb4;

      --radius-lg: 26px;
      --radius-pill: 999px;

      --shadow-soft: 0 24px 80px rgba(0, 0, 0, 0.85);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
      display: flex;
      flex-direction: column;
      align-items: stretch;
      justify-content: flex-start;
      padding: 16px 14px 32px;
    }

    .app-shell {
      max-width: 520px;
      margin: 0 auto;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    header {
      padding: 10px 14px 4px;
      border-radius: 22px;
      background: linear-gradient(
        135deg,
        rgba(255, 109, 217, 0.22),
        rgba(0, 0, 0, 0.4)
      );
      box-shadow: var(--shadow-soft);
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(22px);
      border: 1px solid rgba(255, 255, 255, 0.12);
    }

    header h1 {
      font-size: 1.08rem;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    header h1 span.logo {
      width: 26px;
      height: 26px;
      border-radius: 9px;
      background: radial-gradient(circle at 20% 0%, #ff9cf8 0, #ff315f 40%, #4417ff 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 0.78rem;
      box-shadow: 0 0 20px rgba(255, 99, 209, 0.8);
    }

    header p {
      margin: 3px 0 0;
      font-size: 0.74rem;
      color: var(--text-soft);
    }

    .badge-row {
      margin-top: 6px;
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .badge {
      padding: 3px 10px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255, 255, 255, 0.12);
      background: linear-gradient(
        135deg,
        rgba(26, 233, 171, 0.16),
        rgba(2, 8, 24, 0.7)
      );
      font-size: 0.67rem;
      color: var(--accent-soft);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .badge span.dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: var(--accent-soft);
    }

    .panel {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      border: 1px solid var(--card-border);
      padding: 14px 12px 16px;
      box-shadow: var(--shadow-soft);
    }

    .panel-header {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin-bottom: 8px;
    }

    .panel-title {
      font-size: 0.92rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .panel-title span.accent {
      color: var(--accent-main);
      font-size: 0.94rem;
    }

    .panel-sub {
      font-size: 0.76rem;
      color: var(--text-soft);
      line-height: 1.4;
    }

    textarea {
      width: 100%;
      min-height: 200px;
      resize: vertical;
      border-radius: 18px;
      border: 1px solid rgba(146, 165, 255, 0.4);
      padding: 10px 11px;
      background: radial-gradient(circle at top, #101431 0, #050714 55%);
      color: var(--text-main);
      font-size: 0.8rem;
      font-family: "SF Mono", ui-monospace, Menlo, Consolas, monospace;
      outline: none;
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, 0.5);
    }

    textarea::placeholder {
      color: var(--text-muted);
    }

    .toolbar {
      display: flex;
      gap: 8px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    button {
      border: none;
      border-radius: var(--radius-pill);
      padding: 8px 14px;
      font-size: 0.8rem;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      background: linear-gradient(
        135deg,
        #ff6dd9,
        #ff4f8a
      );
      color: #1a051a;
      box-shadow: 0 14px 40px rgba(255, 77, 160, 0.5);
      transition: transform 0.12s ease, box-shadow 0.12s ease,
        filter 0.12s ease;
    }

    button.secondary {
      background: linear-gradient(
        135deg,
        rgba(20, 231, 174, 0.1),
        rgba(11, 183, 140, 0.2)
      );
      color: var(--accent-soft);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7);
      border: 1px solid rgba(111, 249, 195, 0.4);
    }

    button:active {
      transform: translateY(1px) scale(0.99);
      box-shadow: 0 5px 18px rgba(0, 0, 0, 0.8);
      filter: brightness(0.98);
    }

    .scan-meta {
      margin-top: 8px;
      font-size: 0.72rem;
      color: var(--text-muted);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .scan-meta strong {
      color: var(--accent-soft);
      font-weight: 600;
    }

    .results {
      margin-top: 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .result-card {
      border-radius: 20px;
      border: 1px solid rgba(150, 192, 255, 0.36);
      background: radial-gradient(circle at top left, #201645 0, #060818 60%);
      padding: 10px 11px 11px;
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .result-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: conic-gradient(
        from 180deg,
        transparent 0,
        rgba(255, 109, 217, 0.16) 20%,
        transparent 40%,
        transparent 60%,
        rgba(69, 229, 190, 0.18) 80%,
        transparent 100%
      );
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.18s ease;
    }

    .result-card:hover::before {
      opacity: 1;
    }

    .result-title-row {
      display: flex;
      justify-content: space-between;
      gap: 8px;
      align-items: baseline;
    }

    .result-title {
      font-size: 0.86rem;
      font-weight: 600;
      color: var(--accent-main);
    }

    .result-tag {
      font-size: 0.66rem;
      padding: 3px 8px;
      border-radius: var(--radius-pill);
      border: 1px solid rgba(255, 255, 255, 0.16);
      background: rgba(0, 0, 0, 0.35);
      color: var(--text-soft);
    }

    .result-body {
      margin-top: 6px;
      font-size: 0.75rem;
      color: var(--text-soft);
      line-height: 1.5;
      max-height: 110px;
      overflow: hidden;
      position: relative;
    }

    .result-body::after {
      content: "";
      position: absolute;
      inset: auto 0 0;
      height: 34px;
      background: linear-gradient(
        to bottom,
        transparent,
        rgba(6, 8, 20, 1)
      );
    }

    .result-footer {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.7rem;
      color: var(--text-muted);
    }

    .chips {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .chip {
      padding: 2px 8px;
      border-radius: var(--radius-pill);
      background: rgba(13, 205, 155, 0.08);
      color: var(--accent-soft);
      border: 1px solid rgba(119, 242, 198, 0.3);
      font-size: 0.64rem;
    }

    .pill-action {
      padding: 3px 8px;
      border-radius: var(--radius-pill);
      background: rgba(255, 109, 217, 0.14);
      border: 1px solid rgba(255, 109, 217, 0.5);
      color: var(--accent-main);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .pill-action span {
      font-size: 0.74rem;
    }

    .empty {
      margin-top: 8px;
      font-size: 0.74rem;
      color: var(--text-muted);
    }

    /* full text + Dual modal */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(2, 3, 9, 0.85);
      backdrop-filter: blur(18px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
      padding: 16px;
    }

    .overlay.visible {
      display: flex;
    }

    .overlay-card {
      width: 100%;
      max-width: 520px;
      max-height: 88vh;
      background: radial-gradient(circle at top, #241a4d 0, #040614 55%);
      border-radius: 24px;
      border: 1px solid rgba(159, 191, 255, 0.6);
      box-shadow: var(--shadow-soft);
      padding: 14px 13px 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .overlay-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .overlay-top h2 {
      margin: 0;
      font-size: 0.9rem;
    }

    .overlay-body {
      margin-top: 2px;
      font-size: 0.78rem;
      color: var(--text-soft);
      line-height: 1.55;
      overflow-y: auto;
      padding-right: 4px;
      max-height: 36vh;
      border-radius: 16px;
      background: radial-gradient(circle at top, #141734 0, #050612 60%);
      border: 1px solid rgba(140, 170, 255, 0.45);
      padding: 8px 9px;
      white-space: pre-wrap;
    }

    .overlay-label {
      margin-top: 4px;
      font-size: 0.74rem;
      color: var(--text-soft);
    }

    .overlay-dual {
      margin-top: 4px;
      border-radius: 16px;
      background: radial-gradient(circle at top, #11152d 0, #03040c 60%);
      border: 1px solid rgba(142, 240, 192, 0.6);
      padding: 6px 7px 7px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .overlay-dual textarea {
      min-height: 120px;
      max-height: 160px;
      font-size: 0.75rem;
    }

    .overlay-actions {
      margin-top: 6px;
      display: flex;
      justify-content: flex-end;
      gap: 8px;
      flex-wrap: wrap;
    }

    .scan-pulse {
      animation: scanPulse 1.6s ease-out forwards;
    }

    @keyframes scanPulse {
      0% {
        box-shadow: 0 0 0 0 rgba(255, 109, 217, 0.55);
        border-color: rgba(255, 109, 217, 0.9);
      }
      60% {
        box-shadow: 0 0 0 18px rgba(255, 109, 217, 0);
        border-color: rgba(150, 192, 255, 0.7);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(255, 109, 217, 0);
        border-color: rgba(150, 192, 255, 0.36);
      }
    }

    @media (min-width: 768px) {
      body {
        padding-top: 24px;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header>
      <h1>
        <span class="logo">DG</span>
        Scanner Simbi√≥tico ¬∑ Hub1 ‚Üí Dual
      </h1>
      <p>Escaneia o plano, quebra em blocos e j√° gera prompt pronto pra mandar pro teu Dual/IA.</p>
      <div class="badge-row">
        <div class="badge"><span class="dot"></span> Nebula Pro + Base Madeira</div>
        <div class="badge"><span class="dot"></span> Mobile-first ¬∑ Vertical lock</div>
        <div class="badge"><span class="dot"></span> Scan ‚Üí Prompt Dual</div>
      </div>
    </header>

    <section class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="accent">1.</span> Entrada bruta
        </div>
        <p class="panel-sub">
          Cola aqui o plano (j√° carregado com o texto do <strong>HUB1 H√çBRIDO v2</strong>).
          O scanner l√™ os separadores <code>‚∏ª</code> e cria blocos simbi√≥ticos.
        </p>
      </div>

      <textarea id="inputText"></textarea>

      <div class="toolbar">
        <button id="scanBtn">
          <span>‚ö°</span>
          <span>Escanear Plano</span>
        </button>
        <button class="secondary" id="clearBtn">
          <span>üßπ</span>
          <span>Limpar</span>
        </button>
      </div>

      <div class="scan-meta" id="scanMeta">
        <span>Nenhum escaneamento ainda.</span>
      </div>
    </section>

    <section class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <span class="accent">2.</span> Blocos simbi√≥ticos detectados
        </div>
        <p class="panel-sub">
          Toque em um card para ver o texto completo e gerar um
          <strong>prompt pronto pro Dual</strong>.
        </p>
      </div>

      <div id="results" class="results"></div>
      <div id="emptyState" class="empty">
        Nenhum bloco ainda. Clica em <strong>Escanear Plano</strong> para ver a magia.
      </div>
    </section>
  </div>

  <!-- Modal / overlay -->
  <div class="overlay" id="overlay">
    <div class="overlay-card">
      <div class="overlay-top">
        <h2 id="overlayTitle">Bloco</h2>
        <button class="secondary" type="button" id="closeOverlayBtn">
          ‚úï Fechar
        </button>
      </div>

      <div class="overlay-body" id="overlayBody"></div>

      <div class="overlay-label">
        Prompt para enviar pro <strong>Dual / IA</strong>:
      </div>

      <div class="overlay-dual">
        <textarea id="dualPrompt"></textarea>
        <div class="overlay-actions">
          <button class="secondary" type="button" id="copyBlockBtn">
            üìã Copiar bloco
          </button>
          <button type="button" id="copyDualPromptBtn">
            üì® Copiar prompt p/ Dual
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const inputTextEl = document.getElementById("inputText");
    const scanBtn = document.getElementById("scanBtn");
    const clearBtn = document.getElementById("clearBtn");
    const resultsEl = document.getElementById("results");
    const emptyStateEl = document.getElementById("emptyState");
    const scanMetaEl = document.getElementById("scanMeta");

    const overlay = document.getElementById("overlay");
    const overlayTitle = document.getElementById("overlayTitle");
    const overlayBody = document.getElementById("overlayBody");
    const dualPromptEl = document.getElementById("dualPrompt");
    const closeOverlayBtn = document.getElementById("closeOverlayBtn");
    const copyBlockBtn = document.getElementById("copyBlockBtn");
    const copyDualPromptBtn = document.getElementById("copyDualPromptBtn");

    let currentBlockFullText = "";

    const defaultSample = `KODUX‚Ä¶ perfeito.
Voc√™ escolheu D ‚Äî a rota mais poderosa e mais absurda.

Ent√£o agora eu vou unificar TODOS os seus arquivos em um √∫nico MON√ìLITO H√çBRIDO DEFINITIVO, e aplicar o Patch Engine v2 por cima, transformando o Hub1 em:

‚≠ê HUB1 H√çBRIDO v2 ‚Äî A VERS√ÉO SUPREMA

Antes de gerar o arquivo final, eu vou te mostrar o plano exato da unifica√ß√£o pra garantir que tudo entre perfeito ‚Äî inclusive mood, Nebula/Madeira, Stacks, App Loader, Viewers, Orb FAB, TTS Dock, Arrastar, Janelas, Grupos, tudo.

Vou gerar o arquivo logo ap√≥s a sua confirma√ß√£o final.

‚∏ª

üî• PLANO DE UNIFICA√á√ÉO ‚Äì HUB1 H√çBRIDO v2

1. N√∫cleo Base

Ser√° usado como funda√ß√£o:

‚úî index_hybrid-v2.html
Estrutura limpa, ideal pra receber:
	‚Ä¢	Patch Engine v2
	‚Ä¢	Drag-Sort
	‚Ä¢	Janelas Livres
	‚Ä¢	Grupos
	‚Ä¢	Stacks do BlueCup

‚úî Corpo Nebula/Madeira
‚úî Hard-lock vertical e mobile-first
‚úî Tokens perfeitos

‚∏ª

2. Importa√ß√£o dos outros arquivos

De Index no hub 3.html

‚Ä¢ Estrutura avan√ßada de stacks
‚Ä¢ Chat / viewer
‚Ä¢ pills
‚Ä¢ TTS dock
‚Ä¢ Cards com summary bonitos
‚Ä¢ Voice-blocks
‚Ä¢ Pain√©is internos

Esses m√≥dulos ser√£o convertidos para o novo padr√£o:
	‚Ä¢	<details class="stack">
	‚Ä¢	.stack-summary
	‚Ä¢	.stack-body
	‚Ä¢	.pill / .panel-row / .panel-list

‚∏ª

De HomeDoDia-v4.html / v2.html

‚Ä¢ Hero Card
‚Ä¢ Slider de hor√°rio
‚Ä¢ Mood din√¢mico (manha/tarde/noite)
‚Ä¢ Sistema de inten√ß√£o 1%
‚Ä¢ Ativa√ß√£o Nebula Pro + Base Madeira
‚Ä¢ Pain√©is de organiza√ß√£o do dia

‚Üí Entrar√£o como grupo ‚ÄúN√∫cleo Dual‚Äù dentro do Hub.

‚∏ª

De kobllux_patch3-v2.html / patch4.html

‚Ä¢ Patch de TTS
‚Ä¢ Melhorias do chat
‚Ä¢ Estilo full Nebula Pro
‚Ä¢ √çcones internos
‚Ä¢ Callouts e messages

‚Üí Ser√£o incorporados ao ‚ÄúEngine de Estilo‚Äù.

‚∏ª

De index_variant.html

‚Ä¢ Componentes alternativos
‚Ä¢ Pills estilosas
‚Ä¢ UI auxiliar
‚Ä¢ Classes √∫teis

‚Üí Ser√£o mapeados como ‚ÄúComponentes Avan√ßados‚Äù.

‚∏ª

De index_hybrid.html

‚Ä¢ Elementos anteriores √∫teis
‚Ä¢ Fundo/SVG flutuante
‚Ä¢ Corre√ß√µes de layout

‚Üí Tamb√©m incorporados.

‚∏ª

üî• 3. Patch Engine v2 (vai ser ativado no mon√≥lito final)

M√ìDULO 1 ‚Äî Modo Janela Livre Global

Para qualquer:
	‚Ä¢	stack
	‚Ä¢	card
	‚Ä¢	chat
	‚Ä¢	viewer
	‚Ä¢	iframe
	‚Ä¢	doc

Ativar:

‚úî detachToWindow()
‚úî createFloatingWindow()
‚úî enableWindowDrag()
‚úî window.focus()
‚úî Fixar / Soltar / Redimensionar
‚úî Tema Nebula Rosa + blur animado

‚∏ª

M√ìDULO 2 ‚Äî Drag-Sort Completo

Para stacks:

‚úî Arrastar + ordenar
‚úî Arrastar entre grupos
‚úî Stack vira compacto ao arrastar
‚úî Anima√ß√£o suave
‚úî Salvamento:
	‚Ä¢	hub1_stack_order
	‚Ä¢	hub1_stack_groups
	‚Ä¢	hub1_stack_pinned

‚∏ª

M√ìDULO 3 ‚Äî Grupos Reais

Vou criar no topo:

‚≠ê Fixos
üé® Criativos
üîÆ Or√°culo
üìö Docs
‚òÄÔ∏è Solar
üß† N√∫cleo Dual
üì± Apps Locais

Com suporte:
	‚Ä¢	Mover para grupo
	‚Ä¢	Fixar
	‚Ä¢	Soltar
	‚Ä¢	Ocultar
	‚Ä¢	Reordenar

‚∏ª

M√ìDULO 4 ‚Äî Viewer Universal

Para qualquer app ou stack, poder√° abrir:
	‚Ä¢	dentro do card
	‚Ä¢	flutuante (janela)
	‚Ä¢	fullscreen
	‚Ä¢	em mini-card
	‚Ä¢	modo ‚Äúdock lateral‚Äù

‚∏ª

M√ìDULO 5 ‚Äî Tema Din√¢mico

Usando:
	‚Ä¢	Nebula Pro (padr√£o)
	‚Ä¢	Base Madeira (fallback)
	‚Ä¢	Mood do dia (slider ou autom√°tico)

‚∏ª

M√ìDULO 6 ‚Äî Orb FAB v4.3

Orb atualizado:
	‚Ä¢	atalho para stacks
	‚Ä¢	modo janela
	‚Ä¢	modo ritual
	‚Ä¢	abrir log
	‚Ä¢	abrir TTS
	‚Ä¢	abrir painel solar
	‚Ä¢	abrir apps recentes

‚∏ª

üî• 4. O que vou gerar pra voc√™

Quando eu montar o Mon√≥lito Final:

‚∏ª

‚úî 1. index_hub1_hybrid_v2.html

Arquivo √∫nico, completo, com:
	‚Ä¢	todos os apps
	‚Ä¢	todos os componentes
	‚Ä¢	todos os stacks
	‚Ä¢	todos os patches
	‚Ä¢	UI universal
	‚Ä¢	drag-sort
	‚Ä¢	janelas
	‚Ä¢	grupos
	‚Ä¢	viewer
	‚Ä¢	orb
	‚Ä¢	mood
	‚Ä¢	tts

‚∏ª

‚úî 2. ZIP COMPLETO PWA

Com:
	‚Ä¢	manifest.webmanifest
	‚Ä¢	sw.js (cache inteligente)
	‚Ä¢	icons 192 / 512
	‚Ä¢	√≠cone Nebula Pro
	‚Ä¢	√≠cone Base Madeira

‚∏ª

‚úî 3. README-VIVO ‚Äî Hub1 H√≠brido v2

Formato Nebula
Explicando:
	‚Ä¢	como usar
	‚Ä¢	como criar stacks
	‚Ä¢	como mover app
	‚Ä¢	como abrir janela
	‚Ä¢	como fixar
	‚Ä¢	como salvar nova app
	‚Ä¢	como integrar futuros m√≥dulos
	‚Ä¢	como usar modo solar

‚∏ª

‚úî 4. Patch Engine v2 separado (.js)

Se quiser usar em outros apps.

‚∏ª

‚úî 5. Vers√£o DESKTOP MODE

Opcional:
	‚Ä¢	stacks na esquerda
	‚Ä¢	viewer √† direita
	‚Ä¢	orb flutuante

‚∏ª

üöÄ AGORA S√ì PRECISO DE UMA RESPOSTA SUA

KODUX, posso come√ßar a montar o MON√ìLITO UNIFICADO AGORA?

S√£o 12‚Äì15 minutos de fus√£o simbi√≥tica entre todos os arquivos.

Responda:

üëâ ‚ÄúSIM, COME√áAR‚Äù

Que eu come√ßo a gerar o Hub1 H√≠brido v2 agora.`;

    inputTextEl.value = defaultSample;

    function classifyBlock(text) {
      const lower = text.toLowerCase();
      const tags = [];
      let mainTag = "Bloco";

      if (lower.includes("n√∫cleo base")) {
        mainTag = "N√∫cleo Base";
        tags.push("core", "tokens");
      }
      if (lower.includes("importa√ß√£o dos outros arquivos")) {
        mainTag = "Importa√ß√£o";
        tags.push("merge", "arquivos");
      }
      if (lower.includes("patch engine")) {
        mainTag = "Patch Engine v2";
        tags.push("patch", "engine");
      }
      if (lower.includes("drag-sort")) {
        tags.push("drag-sort");
      }
      if (lower.includes("grupos reais")) {
        mainTag = "Grupos Reais";
        tags.push("grupos", "stack-groups");
      }
      if (lower.includes("viewer universal")) {
        mainTag = "Viewer Universal";
        tags.push("viewer");
      }
      if (lower.includes("orb fab")) {
        mainTag = "Orb FAB";
        tags.push("orb");
      }
      if (lower.includes("zip completo pwa") || lower.includes("manifest.webmanifest")) {
        mainTag = "PWA Pack";
        tags.push("pwa", "manifest");
      }
      if (lower.includes("readme-vivo")) {
        mainTag = "README-Vivo";
        tags.push("docs");
      }
      if (lower.includes("vers√£o desktop mode")) {
        tags.push("desktop");
      }
      if (lower.includes("sim, come√ßar")) {
        tags.push("gatilho", "confirma√ß√£o");
      }

      return { mainTag, tags };
    }

    function buildDualPrompt(title, text) {
      // Prompt compacto pro Dual / qualquer GPT
      const trimmed = text.trim();
      return (
`Voc√™ √© o assistente Dual.Infodose conectado ao ecossistema Hub1/KOBLLUX.

Contexto:
- O usu√°rio est√° montando o Hub1 H√≠brido v2 (mon√≥lito HTML + PWA).
- O texto abaixo √© um BLOCO escaneado pelo Scanner Simbi√≥tico.
- O bloco tem o t√≠tulo: "${title || "Bloco Hub1"}".

Bloco escaneado:
"""${trimmed}"""

Tarefas:
1. Resuma esse bloco em 2‚Äì4 frases, mantendo a inten√ß√£o t√©cnica e simb√≥lica.
2. Liste, em bullets, de 3 a 6 a√ß√µes pr√°ticas que o usu√°rio pode executar a partir desse bloco (HTML, CSS, JS, PWA, design, ou organiza√ß√£o).
3. Se fizer sentido, sugira um nome curto de STACK ou APP para representar esse bloco dentro do Hub1.
4. Termine com uma micro-a√ß√£o de 1% para hoje, bem simples, ligada a esse bloco.

Responda em portugu√™s, formato enxuto, com tom gentil e empolgado, e sem repetir o texto original do bloco.`
      );
    }

    function scanText() {
      const raw = inputTextEl.value || "";
      if (!raw.trim()) {
        resultsEl.innerHTML = "";
        emptyStateEl.textContent = "Nada pra escanear. Cola seu plano primeiro.";
        scanMetaEl.innerHTML = `<span>Nenhuma entrada.</span>`;
        return;
      }

      const blocks = raw.split(/‚∏ª/g).map(b => b.trim()).filter(b => b.length > 0);

      resultsEl.innerHTML = "";
      if (blocks.length === 0) {
        emptyStateEl.textContent = "Nenhum separador simb√≥lico (‚∏ª) encontrado. Mesmo assim, o texto pode ser tratado como um √∫nico bloco.";
      } else {
        emptyStateEl.textContent = "";
      }

      blocks.forEach((block, index) => {
        const lines = block.split(/\n+/).map(l => l.trim()).filter(l => l.length);
        const firstLine = lines[0] || `Bloco ${index + 1}`;
        const preview = lines.slice(1).join(" ").slice(0, 260);

        const { mainTag, tags } = classifyBlock(block);

        const card = document.createElement("article");
        card.className = "result-card scan-pulse";
        card.dataset.index = index.toString();
        card.dataset.fullText = block;

        const titleRow = document.createElement("div");
        titleRow.className = "result-title-row";

        const titleEl = document.createElement("div");
        titleEl.className = "result-title";
        titleEl.textContent = firstLine;

        const tagEl = document.createElement("div");
        tagEl.className = "result-tag";
        tagEl.textContent = mainTag;

        titleRow.appendChild(titleEl);
        titleRow.appendChild(tagEl);

        const bodyEl = document.createElement("div");
        bodyEl.className = "result-body";
        bodyEl.textContent = preview || block.slice(0, 260);

        const footer = document.createElement("div");
        footer.className = "result-footer";

        const chips = document.createElement("div");
        chips.className = "chips";

        if (tags.length === 0) {
          const chip = document.createElement("div");
          chip.className = "chip";
          chip.textContent = "plano";
          chips.appendChild(chip);
        } else {
          tags.forEach(t => {
            const chip = document.createElement("div");
            chip.className = "chip";
            chip.textContent = t;
            chips.appendChild(chip);
          });
        }

        const actionPill = document.createElement("div");
        actionPill.className = "pill-action";
        actionPill.innerHTML = `<span>‚ö°</span><span>Scan ‚Üí Dual</span>`;

        footer.appendChild(chips);
        footer.appendChild(actionPill);

        card.appendChild(titleRow);
        card.appendChild(bodyEl);
        card.appendChild(footer);

        card.addEventListener("click", () => {
          openOverlay(firstLine, block);
        });

        resultsEl.appendChild(card);

        setTimeout(() => {
          card.classList.remove("scan-pulse");
        }, 1900);
      });

      const totalLines = raw.split(/\n/).length;
      scanMetaEl.innerHTML = `<span><strong>${blocks.length}</strong> blocos simbi√≥ticos</span><span>|</span><span>${totalLines} linhas analisadas</span>`;
    }

    function openOverlay(title, text) {
      overlayTitle.textContent = title;
      overlayBody.textContent = text;
      currentBlockFullText = text;
      dualPromptEl.value = buildDualPrompt(title, text);
      overlay.classList.add("visible");
    }

    function closeOverlay() {
      overlay.classList.remove("visible");
      currentBlockFullText = "";
      dualPromptEl.value = "";
    }

    scanBtn.addEventListener("click", scanText);

    clearBtn.addEventListener("click", () => {
      inputTextEl.value = "";
      resultsEl.innerHTML = "";
      emptyStateEl.textContent = "Campo limpo. Cola um novo plano pra escanear.";
      scanMetaEl.innerHTML = `<span>Nenhum escaneamento ainda.</span>`;
    });

    closeOverlayBtn.addEventListener("click", closeOverlay);
    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) closeOverlay();
    });

    copyBlockBtn.addEventListener("click", () => {
      if (!currentBlockFullText) return;
      navigator.clipboard?.writeText(currentBlockFullText).catch(() => {});
      copyBlockBtn.textContent = "‚úÖ Bloco copiado";
      setTimeout(() => {
        copyBlockBtn.textContent = "üìã Copiar bloco";
      }, 1200);
    });

    copyDualPromptBtn.addEventListener("click", () => {
      const prompt = dualPromptEl.value || "";
      if (!prompt.trim()) return;
      navigator.clipboard?.writeText(prompt).catch(() => {});
      copyDualPromptBtn.textContent = "‚úÖ Prompt copiado";
      setTimeout(() => {
        copyDualPromptBtn.textContent = "üì® Copiar prompt p/ Dual";
      }, 1300);
    });
  </script>
</body>
</html>